<div class="stats-breakdown">

  {{!-- Summary --}}
  <div class="stats-summary flexrow">
    <span>{{localize "ASPECTSOFPOWER.Stats.totalCalculated"}}: {{statsSummary.totalCalculated}}</span>
    <span>{{localize "ASPECTSOFPOWER.Stats.globalEquipCap"}}: {{statsSummary.globalCap}}</span>
    <span>{{localize "ASPECTSOFPOWER.Stats.equipmentUsed"}}: {{statsSummary.totalEquipCapped}} / {{statsSummary.totalEquipRaw}}</span>
  </div>

  {{!-- Column headers --}}
  <div class="stat-header flexrow">
    <span class="stat-col-name">{{localize "ASPECTSOFPOWER.AttributeGroup.abilities"}}</span>
    <span class="stat-col">{{localize "ASPECTSOFPOWER.Stats.base"}}</span>
    <span class="stat-col">{{localize "ASPECTSOFPOWER.Stats.calculated"}}</span>
    <span class="stat-col">{{localize "ASPECTSOFPOWER.Stats.equipmentBonus"}}</span>
    <span class="stat-col">{{localize "ASPECTSOFPOWER.Stats.equipmentCap"}}</span>
    <span class="stat-col">{{localize "ASPECTSOFPOWER.Stats.effectBonus"}}</span>
    <span class="stat-col">{{localize "ASPECTSOFPOWER.Stats.withEquipment"}}</span>
    <span class="stat-col">{{localize "ASPECTSOFPOWER.Stats.finalMod"}}</span>
  </div>

  {{!-- One row per ability --}}
  <div class="stat-list">
    {{#each system.abilities as |ability key|}}
    <div class="stat-row flexrow">
      <label class="stat-col-name rollable"
             data-roll="(d20/100)*@abilities.{{key}}.mod+@abilities.{{key}}.mod"
             data-label="{{localize (lookup @root.config.abilities key)}}">
        {{localize (lookup @root.config.abilities key)}}
      </label>
      <span class="stat-col">
        <input type="number" name="system.abilities.{{key}}.value"
               value="{{ability.breakdown.base}}" min="0" class="stat-input"/>
      </span>
      <span class="stat-col">{{ability.breakdown.calculated}}</span>
      {{#if (gt ability.breakdown.equipmentBonusRaw ability.breakdown.equipmentCapped)}}
        <span class="stat-col capped">
          {{ability.breakdown.equipmentCapped}}
          <span class="raw-value">({{ability.breakdown.equipmentBonusRaw}})</span>
        </span>
      {{else}}
        <span class="stat-col">{{ability.breakdown.equipmentCapped}}</span>
      {{/if}}
      <span class="stat-col">{{ability.breakdown.perStatCap}}</span>
      <span class="stat-col">{{ability.breakdown.effectBonus}}</span>
      <span class="stat-col stat-total"><strong>{{ability.breakdown.final}}</strong></span>
      <span class="stat-col stat-mod rollable"
            data-roll="(d20/100)*@abilities.{{key}}.mod+@abilities.{{key}}.mod"
            data-label="{{localize (lookup @root.config.abilities key)}}">
        {{numberFormat ability.breakdown.finalMod decimals=0 sign=true}}
      </span>
    </div>
    {{/each}}
  </div>

  {{!-- Ranges --}}
  <div class="stats-ranges flexrow">
    <span class="range-item">
      <strong>{{localize "ASPECTSOFPOWER.Range.castingRange"}}:</strong> {{system.castingRange}} ft
    </span>
    <span class="range-item">
      <strong>{{localize "ASPECTSOFPOWER.Range.walkRange"}}:</strong> {{system.walkRange}} ft
    </span>
    <span class="range-item">
      <strong>{{localize "ASPECTSOFPOWER.Range.sprintRange"}}:</strong> {{system.sprintRange}} ft
    </span>
  </div>

</div>
